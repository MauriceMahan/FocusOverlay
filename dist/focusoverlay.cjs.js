/* Focus Overlay - v1.0.5
* https://github.com/mmahandev/FocusOverlay
* Copyright (c) 2020 mmahandev. Licensed MIT */
"use strict";function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var _global=createCommonjsModule(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),_core=createCommonjsModule(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),_core_1=_core.version,_isObject=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_anObject=function(t){if(!_isObject(t))throw TypeError(t+" is not an object!");return t},_fails=function(t){try{return!!t()}catch(t){return!0}},_descriptors=!_fails(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),document$1=_global.document,is=_isObject(document$1)&&_isObject(document$1.createElement),_domCreate=function(t){return is?document$1.createElement(t):{}},_ie8DomDefine=!_descriptors&&!_fails(function(){return 7!=Object.defineProperty(_domCreate("div"),"a",{get:function(){return 7}}).a}),_toPrimitive=function(t,e){if(!_isObject(t))return t;var o,n;if(e&&"function"==typeof(o=t.toString)&&!_isObject(n=o.call(t)))return n;if("function"==typeof(o=t.valueOf)&&!_isObject(n=o.call(t)))return n;if(!e&&"function"==typeof(o=t.toString)&&!_isObject(n=o.call(t)))return n;throw TypeError("Can't convert object to primitive value")},dP=Object.defineProperty,f=_descriptors?Object.defineProperty:function(t,e,o){if(_anObject(t),e=_toPrimitive(e,!0),_anObject(o),_ie8DomDefine)try{return dP(t,e,o)}catch(t){}if("get"in o||"set"in o)throw TypeError("Accessors not supported!");return"value"in o&&(t[e]=o.value),t},_objectDp={f:f},_propertyDesc=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},_hide=_descriptors?function(t,e,o){return _objectDp.f(t,e,_propertyDesc(1,o))}:function(t,e,o){return t[e]=o,t},hasOwnProperty={}.hasOwnProperty,_has=function(t,e){return hasOwnProperty.call(t,e)},id=0,px=Math.random(),_uid=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++id+px).toString(36))},_shared=createCommonjsModule(function(t){var e=_global["__core-js_shared__"]||(_global["__core-js_shared__"]={});(t.exports=function(t,o){return e[t]||(e[t]=void 0!==o?o:{})})("versions",[]).push({version:_core.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),_functionToString=_shared("native-function-to-string",Function.toString),_redefine=createCommonjsModule(function(t){var e=_uid("src"),o=(""+_functionToString).split("toString");_core.inspectSource=function(t){return _functionToString.call(t)},(t.exports=function(t,n,i,r){var s="function"==typeof i;s&&(_has(i,"name")||_hide(i,"name",n)),t[n]!==i&&(s&&(_has(i,e)||_hide(i,e,t[n]?""+t[n]:o.join(String(n)))),t===_global?t[n]=i:r?t[n]?t[n]=i:_hide(t,n,i):(delete t[n],_hide(t,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||_functionToString.call(this)})}),_aFunction=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},_ctx=function(t,e,o){if(_aFunction(t),void 0===e)return t;switch(o){case 1:return function(o){return t.call(e,o)};case 2:return function(o,n){return t.call(e,o,n)};case 3:return function(o,n,i){return t.call(e,o,n,i)}}return function(){return t.apply(e,arguments)}},PROTOTYPE="prototype",$export=function(t,e,o){var n,i,r,s,c=t&$export.F,a=t&$export.G,u=t&$export.S,l=t&$export.P,f=t&$export.B,d=a?_global:u?_global[e]||(_global[e]={}):(_global[e]||{})[PROTOTYPE],h=a?_core:_core[e]||(_core[e]={}),p=h[PROTOTYPE]||(h[PROTOTYPE]={});for(n in a&&(o=e),o)r=((i=!c&&d&&void 0!==d[n])?d:o)[n],s=f&&i?_ctx(r,_global):l&&"function"==typeof r?_ctx(Function.call,r):r,d&&_redefine(d,n,r,t&$export.U),h[n]!=r&&_hide(h,n,s),l&&p[n]!=r&&(p[n]=r)};_global.core=_core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var _export=$export,toString={}.toString,_cof=function(t){return toString.call(t).slice(8,-1)},_iobject=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==_cof(t)?t.split(""):Object(t)},_defined=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},_toIobject=function(t){return _iobject(_defined(t))},ceil=Math.ceil,floor=Math.floor,_toInteger=function(t){return isNaN(t=+t)?0:(t>0?floor:ceil)(t)},min=Math.min,_toLength=function(t){return t>0?min(_toInteger(t),9007199254740991):0},max=Math.max,min$1=Math.min,_toAbsoluteIndex=function(t,e){return(t=_toInteger(t))<0?max(t+e,0):min$1(t,e)},_arrayIncludes=function(t){return function(e,o,n){var i,r=_toIobject(e),s=_toLength(r.length),c=_toAbsoluteIndex(n,s);if(t&&o!=o){for(;s>c;)if((i=r[c++])!=i)return!0}else for(;s>c;c++)if((t||c in r)&&r[c]===o)return t||c||0;return!t&&-1}},shared=_shared("keys"),_sharedKey=function(t){return shared[t]||(shared[t]=_uid(t))},arrayIndexOf=_arrayIncludes(!1),IE_PROTO=_sharedKey("IE_PROTO"),_objectKeysInternal=function(t,e){var o,n=_toIobject(t),i=0,r=[];for(o in n)o!=IE_PROTO&&_has(n,o)&&r.push(o);for(;e.length>i;)_has(n,o=e[i++])&&(~arrayIndexOf(r,o)||r.push(o));return r},_enumBugKeys="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),_objectKeys=Object.keys||function(t){return _objectKeysInternal(t,_enumBugKeys)},f$1=Object.getOwnPropertySymbols,_objectGops={f:f$1},f$2={}.propertyIsEnumerable,_objectPie={f:f$2},_toObject=function(t){return Object(_defined(t))},$assign=Object.assign,_objectAssign=!$assign||_fails(function(){var t={},e={},o=Symbol(),n="abcdefghijklmnopqrst";return t[o]=7,n.split("").forEach(function(t){e[t]=t}),7!=$assign({},t)[o]||Object.keys($assign({},e)).join("")!=n})?function(t,e){for(var o=_toObject(t),n=arguments.length,i=1,r=_objectGops.f,s=_objectPie.f;n>i;)for(var c,a=_iobject(arguments[i++]),u=r?_objectKeys(a).concat(r(a)):_objectKeys(a),l=u.length,f=0;l>f;)c=u[f++],_descriptors&&!s.call(a,c)||(o[c]=a[c]);return o}:$assign;_export(_export.S+_export.F,"Object",{assign:_objectAssign});var _wks=createCommonjsModule(function(t){var e=_shared("wks"),o=_global.Symbol,n="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=n&&o[t]||(n?o:_uid)("Symbol."+t))}).store=e}),UNSCOPABLES=_wks("unscopables"),ArrayProto=Array.prototype;null==ArrayProto[UNSCOPABLES]&&_hide(ArrayProto,UNSCOPABLES,{});var _addToUnscopables=function(t){ArrayProto[UNSCOPABLES][t]=!0},$includes=_arrayIncludes(!0);_export(_export.P,"Array",{includes:function(t){return $includes(this,t,arguments.length>1?arguments[1]:void 0)}}),_addToUnscopables("includes");var MATCH=_wks("match"),_isRegexp=function(t){var e;return _isObject(t)&&(void 0!==(e=t[MATCH])?!!e:"RegExp"==_cof(t))},_stringContext=function(t,e,o){if(_isRegexp(e))throw TypeError("String#"+o+" doesn't accept regex!");return String(_defined(t))},MATCH$1=_wks("match"),_failsIsRegexp=function(t){var e=/./;try{"/./"[t](e)}catch(o){try{return e[MATCH$1]=!1,!"/./"[t](e)}catch(t){}}return!0},INCLUDES="includes";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}_export(_export.P+_export.F*_failsIsRegexp(INCLUDES),"String",{includes:function(t){return!!~_stringContext(this,t,INCLUDES).indexOf(t,arguments.length>1?arguments[1]:void 0)}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null});var dP$1=_objectDp.f,FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME="name";function extend(){for(var t,e,o,n=arguments[0]||{},i=1,r=arguments.length;i<r;i++)if(null!==(t=arguments[i]))for(e in t)n!==(o=t[e])&&void 0!==o&&(n[e]=o);return n}function absolutePosition(t){var e,o=0,n=0,i=0,r=0,s=absolutePosition.offsetBase;if(!s&&document.body&&((s=absolutePosition.offsetBase=document.createElement("div")).style.cssText="position:absolute;left:0;top:0",document.body.appendChild(s)),t&&t.ownerDocument===document&&"getBoundingClientRect"in t&&s){var c=t.getBoundingClientRect(),a=s.getBoundingClientRect();e=!0,o=c.left-a.left,n=c.top-a.top,i=c.right-c.left,r=c.bottom-c.top}return{found:e,left:o,top:n,width:i,height:r,right:o+i,bottom:n+r}}function whichTransitionEvent(){var t=document.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var o in e)if(void 0!==t.style[o])return e[o]}function debounce(t,e){var o;return function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];clearTimeout(o),o=window.setTimeout(function(){return t.apply(void 0,i)},e)}}NAME in FProto||_descriptors&&dP$1(FProto,NAME,{configurable:!0,get:function(){try{return(""+this).match(nameRE)[1]}catch(t){return""}}});var FocusOverlay=function(){function t(e,o){_classCallCheck(this,t),this.active=!1,this.scopedEl,this.focusBox,this.previousTarget,this.nextTarget,this.timeout=0,this.inScope=!1,this.transitionEvent=whichTransitionEvent(),this.options=extend({class:"focus-overlay",activeClass:"focus-overlay-active",animatingClass:"focus-overlay-animating",targetClass:"focus-overlay-target",zIndex:9001,duration:500,inactiveAfterDuration:!1,triggerKeys:[9,36,37,38,39,40,13,32,16,17,18,27],inactiveOnNonTriggerKey:!0,inactiveOnClick:!0,alwaysActive:!1,watchTransitionEnd:!0,debounceScroll:!0,debounceResize:!0,debounceMs:150,onInit:function(){},onBeforeMove:function(){},onAfterMove:function(){},onDestroy:function(){}},o||{}),e instanceof Element?this.scopedEl=e:"string"==typeof e||e instanceof String?this.scopedEl=document.querySelector(e):this.scopedEl=document.querySelector("body"),this.onKeyDownHandler=this.onKeyDownHandler.bind(this),this.onFocusHandler=this.onFocusHandler.bind(this),this.moveFocusBox=this.moveFocusBox.bind(this),this.stop=this.stop.bind(this),this.debouncedMoveFocusBox=debounce(this.moveFocusBox,this.options.debounceMs),this.init()}return _createClass(t,[{key:"init",value:function(){this.options.alwaysActive?(this.active=!0,window.addEventListener("focusin",this.onFocusHandler,!0)):(window.addEventListener("keydown",this.onKeyDownHandler,!1),this.options.inactiveOnClick&&window.addEventListener("mousedown",this.stop,!1)),this._createFocusBox(),this.options.onInit(this)}},{key:"onKeyDownHandler",value:function(t){var e=this,o=t.which;this.options.triggerKeys.includes(o)?(!1===this.active&&(this.active=!0,window.addEventListener("focusin",this.onFocusHandler,!0),this.options.debounceScroll&&window.addEventListener("scroll",this.debouncedMoveFocusBox,!0),this.options.debounceResize&&window.addEventListener("resize",this.debouncedMoveFocusBox,!1)),setTimeout(function(){var t=document.activeElement;t instanceof HTMLIFrameElement&&e.scopedEl.contains(t)&&!0===e.active&&e.moveFocusBox(t)},5)):this.options.inactiveOnNonTriggerKey&&this.stop()}},{key:"_createFocusBox",value:function(){this.focusBox=document.createElement("div"),this.focusBox.setAttribute("aria-hidden","true"),this.focusBox.classList.add(this.options.class),Object.assign(this.focusBox.style,{position:"absolute",zIndex:this.options.zIndex,pointerEvents:"none"}),this.scopedEl.insertAdjacentElement("beforeend",this.focusBox)}},{key:"_cleanup",value:function(){null!=this.nextTarget&&(this.previousTarget=this.nextTarget,this.previousTarget.classList.remove(this.options.targetClass),this.previousTarget.removeEventListener(this.transitionEvent,this.moveFocusBox))}},{key:"onFocusHandler",value:function(t){var e=t.target;if(this._cleanup(),this.scopedEl.contains(e)){var o=this.nextTarget;if(this.inScope=!0,null!==e.getAttribute("data-focus")){var n=e.getAttribute("data-focus");this.nextTarget=document.querySelector("[data-focus='".concat(n,"']"))}else if(null!==e.getAttribute("data-focus-label")){var i=document.querySelector("[for='".concat(e.id,"']"));null===i&&(i=e.closest("label")),this.nextTarget=i}else{if(null!==e.getAttribute("data-focus-ignore"))return;this.nextTarget=e}clearTimeout(this.timeout),this.transitionEvent&&this.options.watchTransitionEnd&&this.nextTarget.addEventListener(this.transitionEvent,this.moveFocusBox),this.options.onBeforeMove(o,this.nextTarget,this),this.moveFocusBox(this.nextTarget)}else this.options.alwaysActive?this.inScope=!1:(this.inScope=!1,this.stop())}},{key:"stop",value:function(){this.active=!1,window.removeEventListener("focusin",this.onFocusHandler,!0),this.options.debounceScroll&&window.removeEventListener("scroll",this.debouncedMoveFocusBox,!0),this.options.debounceResize&&window.removeEventListener("resize",this.debouncedMoveFocusBox,!1),this._cleanup(),this.focusBox.classList.remove(this.options.activeClass)}},{key:"moveFocusBox",value:function(t){var e=this;if(t instanceof Event&&(t=document.activeElement),t.classList.add(this.options.targetClass),document.body.contains(t)&&t instanceof Element){var o=absolutePosition(t),n="".concat(o.width,"px"),i="".concat(o.height,"px"),r="".concat(o.left,"px"),s="".concat(o.top,"px");this.focusBox.classList.add(this.options.animatingClass),this.focusBox.classList.add(this.options.activeClass),Object.assign(this.focusBox.style,{width:n,height:i,left:r,top:s}),this.timeout=setTimeout(function(){e.focusBox.classList.remove(e.options.animatingClass),e.options.inactiveAfterDuration&&e.focusBox.classList.remove(e.options.activeClass),e.options.onAfterMove(e.previousTarget,t,e)},this.options.duration)}else this._cleanup()}},{key:"destroy",value:function(){null!=this.focusBox.parentElement&&this.focusBox.parentNode.removeChild(this.focusBox),null!=this.previousTarget&&this.previousTarget.classList.remove(this.options.targetClass),null!=this.nextTarget&&this.nextTarget.classList.remove(this.options.targetClass),window.removeEventListener("focusin",this.onFocusHandler,!0),window.removeEventListener("keydown",this.onKeyDownHandler,!1),window.removeEventListener("mousedown",this.stop,!1),this.options.debounceScroll&&window.removeEventListener("scroll",this.debouncedMoveFocusBox,!0),this.options.debounceResize&&window.removeEventListener("resize",this.debouncedMoveFocusBox,!1),this.options.onDestroy(this)}}]),t}();module.exports=FocusOverlay;
